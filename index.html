<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆåéŒ²ã‚¢ãƒ—ãƒª</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        #root { width: 100%; height: 100vh; }
        #debug-log {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            border-top: 2px solid #0f0;
            z-index: 9999;
            display: none;
        }
        #debug-log.show {
            display: block;
        }
        #debug-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 255, 0, 0.2);
            color: #0f0;
            border: 2px solid #0f0;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
        }
        #debug-toggle:hover {
            background: rgba(0, 255, 0, 0.3);
        }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <button id="debug-toggle" onclick="document.getElementById('debug-log').classList.toggle('show'); this.textContent = document.getElementById('debug-log').classList.contains('show') ? 'ğŸ› ãƒ­ã‚°éè¡¨ç¤º' : 'ğŸ› ãƒ­ã‚°è¡¨ç¤º';">ğŸ› ãƒ­ã‚°è¡¨ç¤º</button>
    <div id="debug-log"></div>

    <script>
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢æ•°
        function debugLog(message) {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML = `[${timestamp}] ${message}<br>` + logDiv.innerHTML;
            console.log(`[${timestamp}] ${message}`);
        }
    </script>

    <script type="text/babel">
        // âš ï¸ ã“ã“ã«Firebaseã®è¨­å®šã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
		const firebaseConfig = {
		  apiKey: "AIzaSyDR3QRyEMQTu1EZyx3Tqa0cUH2eIuwO-ss",
		  authDomain: "podcast-console-app.firebaseapp.com",
		  databaseURL: "https://podcast-console-app-default-rtdb.asia-southeast1.firebasedatabase.app",
		  projectId: "podcast-console-app",
		  storageBucket: "podcast-console-app.firebasestorage.app",
		  messagingSenderId: "356790709172",
		  appId: "1:356790709172:web:7a82c41b8629ae3c3060e1"
		};

        debugLog("ğŸš€ ã‚¢ãƒ—ãƒªèµ·å‹•");

        // FirebaseåˆæœŸåŒ–
        let database = null;
        let isFirebaseConfigured = false;

        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                debugLog("ğŸ”„ FirebaseåˆæœŸåŒ–ä¸­...");
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                isFirebaseConfigured = true;
                debugLog("âœ… Firebaseæ¥ç¶šæˆåŠŸ");
            } else {
                debugLog("âš ï¸ Firebaseè¨­å®šãŒæœªå…¥åŠ›ã§ã™");
            }
        } catch (error) {
            debugLog("âŒ FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: " + error.message);
            console.error(error);
        }

        const { useState, useEffect, useRef } = React;

        const PodcastApp = () => {
            const [mode, setMode] = useState(null);
            const [sessionId, setSessionId] = useState('');
            const [isConnected, setIsConnected] = useState(false);
            const [stopwatchTime, setStopwatchTime] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const [promptMessage, setPromptMessage] = useState('');
            const [messageInput, setMessageInput] = useState('');
            const [inputSessionId, setInputSessionId] = useState('');
            const [currentTime, setCurrentTime] = useState('');
            const [connectionStatus, setConnectionStatus] = useState('disconnected');
            const [lastUpdate, setLastUpdate] = useState('æœªæ¥ç¶š');
            const sessionRef = useRef(null);
            const startTimeRef = useRef(null); // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã®é–‹å§‹æ™‚åˆ»
            const timerIntervalRef = useRef(null);

            const presetMessages = [
                'æ¬¡ã¸é€²ã‚ã¦ãã ã•ã„',
                'æ™‚é–“ãŒæŠ¼ã—ã¦ã„ã¾ã™',
                'ã¾ã¨ã‚ã«å…¥ã£ã¦ãã ã•ã„',
                'ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼',
                'æ·±æ˜ã‚Šã—ã¦ãã ã•ã„'
            ];

            // ç¾åœ¨æ™‚åˆ»ã®æ›´æ–°
            useEffect(() => {
                const updateTime = () => {
                    const now = new Date();
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    setCurrentTime(`${hours}:${minutes}`);
                };
                updateTime();
                const interval = setInterval(updateTime, 1000);
                return () => clearInterval(interval);
            }, []);

            // Firebaseã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®ç›£è¦–
            useEffect(() => {
                if (!isFirebaseConfigured || !isConnected || !sessionId || !database) {
                    debugLog("â¸ï¸ Firebaseç›£è¦–åœæ­¢ï¼ˆæœªæ¥ç¶šï¼‰");
                    return;
                }

                debugLog(`ğŸ“¡ ã‚»ãƒƒã‚·ãƒ§ãƒ³ ${sessionId} ã®ç›£è¦–é–‹å§‹ (${mode}ãƒ¢ãƒ¼ãƒ‰)`);
                const sessionPath = `sessions/${sessionId}`;
                sessionRef.current = database.ref(sessionPath);

                // æ¥ç¶šçŠ¶æ…‹ã®ç›£è¦–
                const connectedRef = database.ref('.info/connected');
                const connectedListener = connectedRef.on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        setConnectionStatus('connected');
                        debugLog("ğŸŸ¢ Firebaseæ¥ç¶š: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³");
                    } else {
                        setConnectionStatus('disconnected');
                        debugLog("ğŸ”´ Firebaseæ¥ç¶š: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³");
                    }
                });

                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®ç›£è¦–
                const dataListener = sessionRef.current.on('value', (snapshot) => {
                    const data = snapshot.val();
                    debugLog(`ğŸ“¥ ãƒ‡ãƒ¼ã‚¿å—ä¿¡: ${JSON.stringify(data)}`);
                    
                    if (data) {
                        // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§å—ä¿¡æ™‚ã«çŠ¶æ…‹ã‚’æ›´æ–°
                        if (mode === 'stage' || (mode === 'director' && data.startTime !== undefined)) {
                            setIsRunning(data.isRunning || false);
                            setPromptMessage(data.promptMessage || '');
                            
                            // ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—
                            if (data.isRunning && data.startTime) {
                                startTimeRef.current = data.startTime;
                                const elapsed = Date.now() - data.startTime;
                                setStopwatchTime(elapsed);
                            } else if (!data.isRunning && data.stopwatchTime !== undefined) {
                                setStopwatchTime(data.stopwatchTime);
                                startTimeRef.current = null;
                            }
                            
                            setLastUpdate(new Date().toLocaleTimeString());
                            debugLog(`âœ… çŠ¶æ…‹æ›´æ–° - å®Ÿè¡Œä¸­: ${data.isRunning}, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: "${data.promptMessage}"`);
                        }
                    } else {
                        debugLog("âš ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™");
                    }
                });

                return () => {
                    debugLog("ğŸ›‘ Firebaseç›£è¦–åœæ­¢");
                    if (sessionRef.current) {
                        sessionRef.current.off('value', dataListener);
                    }
                    connectedRef.off('value', connectedListener);
                };
            }, [isConnected, sessionId, mode]);

            // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã®ãƒ­ãƒ¼ã‚«ãƒ«æ›´æ–°ï¼ˆè¡¨ç¤ºã®ã¿ï¼‰
            useEffect(() => {
                if (isRunning && startTimeRef.current) {
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚å‹•ä½œï¼‰
                    timerIntervalRef.current = setInterval(() => {
                        const elapsed = Date.now() - startTimeRef.current;
                        setStopwatchTime(elapsed);
                    }, 10);
                    
                    return () => {
                        if (timerIntervalRef.current) {
                            clearInterval(timerIntervalRef.current);
                        }
                    };
                }
            }, [isRunning]);

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¥ç¶š
            const connectToSession = async () => {
                if (inputSessionId.length >= 4) {
                    if (!isFirebaseConfigured) {
                        alert("âš ï¸ Firebaseè¨­å®šãŒå¿…è¦ã§ã™ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®firebaseConfigã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚");
                        debugLog("âŒ Firebaseæœªè¨­å®šã®ãŸã‚æ¥ç¶šå¤±æ•—");
                        return;
                    }

                    debugLog(`ğŸ”— ã‚»ãƒƒã‚·ãƒ§ãƒ³ ${inputSessionId} ã«æ¥ç¶šè©¦è¡Œ...`);
                    setSessionId(inputSessionId);
                    setIsConnected(true);

                    // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                    try {
                        const snapshot = await database.ref(`sessions/${inputSessionId}`).once('value');
                        const data = snapshot.val();
                        debugLog(`ğŸ“– æ—¢å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿: ${JSON.stringify(data)}`);
                        if (data) {
                            setIsRunning(data.isRunning || false);
                            setPromptMessage(data.promptMessage || '');
                            
                            if (data.isRunning && data.startTime) {
                                startTimeRef.current = data.startTime;
                                const elapsed = Date.now() - data.startTime;
                                setStopwatchTime(elapsed);
                            } else {
                                setStopwatchTime(data.stopwatchTime || 0);
                            }
                            
                            debugLog("âœ… æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶šæˆåŠŸ");
                        } else {
                            debugLog("âš ï¸ æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰");
                        }
                    } catch (error) {
                        debugLog(`âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                        console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
                    }
                }
            };

            // æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
            const createNewSession = () => {
                if (!isFirebaseConfigured) {
                    alert("âš ï¸ Firebaseè¨­å®šãŒå¿…è¦ã§ã™ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®firebaseConfigã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚");
                    debugLog("âŒ Firebaseæœªè¨­å®šã®ãŸã‚ä½œæˆå¤±æ•—");
                    return;
                }

                const newId = Math.floor(1000 + Math.random() * 9000).toString();
                debugLog(`ğŸ†• æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ: ${newId}`);
                setInputSessionId(newId);
                setSessionId(newId);
                setIsConnected(true);

                // åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                database.ref(`sessions/${newId}`).set({
                    stopwatchTime: 0,
                    isRunning: false,
                    promptMessage: '',
                    startTime: null,
                    createdAt: Date.now()
                }).then(() => {
                    debugLog(`âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ ${newId} ã®ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–å®Œäº†`);
                }).catch(err => {
                    debugLog(`âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆã‚¨ãƒ©ãƒ¼: ${err.message}`);
                });
            };

            // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒæ“ä½œ
            const handleStart = () => {
                debugLog("â–¶ï¸ ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒé–‹å§‹");
                const now = Date.now();
                const currentElapsed = stopwatchTime;
                const newStartTime = now - currentElapsed;
                
                startTimeRef.current = newStartTime;
                setIsRunning(true);
                
                if (sessionRef.current) {
                    sessionRef.current.update({
                        isRunning: true,
                        startTime: newStartTime,
                        lastUpdate: now
                    }).then(() => {
                        debugLog("âœ… é–‹å§‹ã‚³ãƒãƒ³ãƒ‰é€ä¿¡æˆåŠŸ");
                    }).catch(err => {
                        debugLog(`âŒ é–‹å§‹ã‚³ãƒãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼: ${err.message}`);
                    });
                }
            };

            const handlePause = () => {
                debugLog("â¸ï¸ ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒåœæ­¢");
                setIsRunning(false);
                startTimeRef.current = null;
                
                if (sessionRef.current) {
                    sessionRef.current.update({
                        isRunning: false,
                        stopwatchTime: stopwatchTime,
                        startTime: null,
                        lastUpdate: Date.now()
                    }).then(() => {
                        debugLog("âœ… åœæ­¢ã‚³ãƒãƒ³ãƒ‰é€ä¿¡æˆåŠŸ");
                    }).catch(err => {
                        debugLog(`âŒ åœæ­¢ã‚³ãƒãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼: ${err.message}`);
                    });
                }
            };

            const handleReset = () => {
                debugLog("ğŸ”„ ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒãƒªã‚»ãƒƒãƒˆ");
                setStopwatchTime(0);
                setIsRunning(false);
                startTimeRef.current = null;
                
                if (sessionRef.current) {
                    sessionRef.current.update({
                        stopwatchTime: 0,
                        isRunning: false,
                        startTime: null,
                        lastUpdate: Date.now()
                    }).then(() => {
                        debugLog("âœ… ãƒªã‚»ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰é€ä¿¡æˆåŠŸ");
                    }).catch(err => {
                        debugLog(`âŒ ãƒªã‚»ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼: ${err.message}`);
                    });
                }
            };

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
            const sendMessage = (message) => {
                debugLog(`ğŸ“¨ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡: "${message}"`);
                setPromptMessage(message);
                if (sessionRef.current) {
                    sessionRef.current.update({
                        promptMessage: message,
                        lastUpdate: Date.now()
                    }).then(() => {
                        debugLog("âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æˆåŠŸ");
                    }).catch(err => {
                        debugLog(`âŒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼: ${err.message}`);
                    });
                }
            };

            const handleSendCustomMessage = () => {
                if (messageInput.trim()) {
                    sendMessage(messageInput);
                    setMessageInput('');
                }
            };

            const handleClearMessage = () => {
                debugLog("ğŸ—‘ï¸ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¯ãƒªã‚¢");
                setPromptMessage('');
                if (sessionRef.current) {
                    sessionRef.current.update({
                        promptMessage: '',
                        lastUpdate: Date.now()
                    }).then(() => {
                        debugLog("âœ… ã‚¯ãƒªã‚¢ã‚³ãƒãƒ³ãƒ‰é€ä¿¡æˆåŠŸ");
                    }).catch(err => {
                        debugLog(`âŒ ã‚¯ãƒªã‚¢ã‚³ãƒãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼: ${err.message}`);
                    });
                }
            };

            // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã®è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            const formatStopwatch = (ms) => {
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            };

            const styles = {
                container: {
                    minHeight: '100vh',
                    backgroundColor: '#000',
                    color: '#fff',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    padding: '32px',
                    paddingBottom: '32px'
                },
                button: {
                    padding: '32px 64px',
                    fontSize: '24px',
                    fontWeight: 'bold',
                    borderRadius: '12px',
                    border: 'none',
                    cursor: 'pointer',
                    margin: '12px',
                    color: '#fff'
                },
                input: {
                    backgroundColor: '#1f2937',
                    color: '#fff',
                    fontSize: '24px',
                    textAlign: 'center',
                    padding: '16px 24px',
                    borderRadius: '8px',
                    border: '2px solid #4b5563',
                    outline: 'none',
                    margin: '12px 0'
                }
            };

            // Firebaseæœªè¨­å®šã®è­¦å‘Š
            if (!isFirebaseConfigured) {
                return (
                    <div style={styles.container}>
                        <div style={{maxWidth: '800px', textAlign: 'center'}}>
                            <h1 style={{fontSize: '48px', marginBottom: '24px'}}>âš ï¸ Firebaseè¨­å®šãŒå¿…è¦ã§ã™</h1>
                            <div style={{backgroundColor: '#1f2937', padding: '32px', borderRadius: '12px', textAlign: 'left', marginBottom: '24px'}}>
                                <p style={{fontSize: '20px', marginBottom: '16px'}}>HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ä»¥ä¸‹ã®éƒ¨åˆ†ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ï¼š</p>
                                <pre style={{backgroundColor: '#111827', padding: '16px', borderRadius: '8px', overflow: 'auto', fontSize: '14px'}}>
{`const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};`}
                                </pre>
                            </div>
                            <p style={{fontSize: '18px', color: '#9ca3af'}}>
                                Firebase Consoleã‹ã‚‰è¨­å®šæƒ…å ±ã‚’å–å¾—ã—ã¦ã€<br/>
                                YOUR_XXX ã®éƒ¨åˆ†ã‚’å®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
                            </p>
                        </div>
                    </div>
                );
            }

            // ãƒ¢ãƒ¼ãƒ‰é¸æŠç”»é¢
            if (!mode) {
                return (
                    <div style={styles.container}>
                        <h1 style={{fontSize: '48px', fontWeight: 'bold', marginBottom: '16px'}}>ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆåéŒ²ã‚¢ãƒ—ãƒª</h1>
                        <p style={{fontSize: '24px', color: '#9ca3af', marginBottom: '48px'}}>ã©ã¡ã‚‰ã®ç”»é¢ã‚’ä½¿ã„ã¾ã™ã‹ï¼Ÿ</p>
                        <div style={{display: 'flex', gap: '24px'}}>
                            <button onClick={() => { setMode('director'); debugLog("ğŸ¬ ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰é¸æŠ"); }} style={{...styles.button, backgroundColor: '#2563eb'}}>
                                ğŸ¬ ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ç”»é¢<br/>
                                <span style={{fontSize: '16px', fontWeight: 'normal'}}>( PCãƒ»æ“ä½œå´)</span>
                            </button>
                            <button onClick={() => { setMode('stage'); debugLog("ğŸ“º ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰é¸æŠ"); }} style={{...styles.button, backgroundColor: '#16a34a'}}>
                                ğŸ“º ã‚¹ãƒ†ãƒ¼ã‚¸ç”»é¢<br/>
                                <span style={{fontSize: '16px', fontWeight: 'normal'}}>(iPadãƒ»è¡¨ç¤ºå´)</span>
                            </button>
                        </div>
                        <p style={{color: '#6b7280', marginTop: '48px', textAlign: 'center', maxWidth: '800px'}}>
                            ğŸ’¡ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒç”»é¢ä¸‹éƒ¨ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                        </p>
                    </div>
                );
            }

            // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ - æ¥ç¶šå‰
            if (mode === 'stage' && !isConnected) {
                return (
                    <div style={styles.container}>
                        <button onClick={() => setMode(null)} style={{position: 'absolute', top: '16px', left: '16px', background: 'none', border: 'none', color: '#9ca3af', fontSize: '20px', cursor: 'pointer'}}>
                            â† æˆ»ã‚‹
                        </button>
                        <div style={{textAlign: 'center'}}>
                            <h1 style={{fontSize: '40px', fontWeight: 'bold', marginBottom: '32px'}}>ã‚¹ãƒ†ãƒ¼ã‚¸ç”»é¢</h1>
                            <p style={{fontSize: '24px', marginBottom: '32px'}}>ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                            <input
                                type="text"
                                value={inputSessionId}
                                onChange={(e) => setInputSessionId(e.target.value)}
                                placeholder="ä¾‹: 1234"
                                style={{...styles.input, fontSize: '32px', width: '256px'}}
                                maxLength="6"
                            />
                            <br />
                            <button onClick={connectToSession} style={{...styles.button, backgroundColor: '#16a34a', fontSize: '24px'}}>
                                æ¥ç¶š
                            </button>
                        </div>
                    </div>
                );
            }

            // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ - ãƒ¡ã‚¤ãƒ³ç”»é¢
            if (mode === 'stage' && isConnected) {
                return (
                    <div style={{minHeight: '100vh', backgroundColor: '#000', color: '#fff', display: 'flex', flexDirection: 'column', padding: '32px', paddingBottom: '32px'}}>
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '32px'}}>
                            <div style={{fontSize: '64px', fontWeight: 'bold'}}>{currentTime}</div>
                            <div style={{display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '8px'}}>
                                <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                                    <div style={{width: '12px', height: '12px', backgroundColor: connectionStatus === 'connected' ? '#22c55e' : '#ef4444', borderRadius: '50%'}} className={connectionStatus === 'connected' ? 'pulse' : ''}></div>
                                    <span style={{fontSize: '20px', color: '#9ca3af'}}>ID: {sessionId}</span>
                                </div>
                                <span style={{fontSize: '14px', color: '#6b7280'}}>æœ€çµ‚æ›´æ–°: {lastUpdate}</span>
                            </div>
                        </div>
                        <div style={{flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '32px'}}>
                            <div style={{textAlign: 'center'}}>
                                <div style={{fontSize: '144px', fontWeight: 'bold', letterSpacing: '0.05em', marginBottom: '16px'}}>
                                    {formatStopwatch(stopwatchTime)}
                                </div>
                                <div style={{fontSize: '32px', color: '#9ca3af'}}>
                                    {isRunning ? 'ğŸ”´ åéŒ²ä¸­' : 'â¸ï¸ ä¸€æ™‚åœæ­¢'}
                                </div>
                            </div>
                        </div>
                        <div style={{backgroundColor: '#111827', borderRadius: '16px', padding: '48px', minHeight: '200px', display: 'flex', alignItems: 'center', justifyContent: 'center', border: '4px solid #374151'}}>
                            {promptMessage ? (
                                <p style={{fontSize: '48px', fontWeight: 'bold', textAlign: 'center', lineHeight: '1.6'}}>
                                    {promptMessage}
                                </p>
                            ) : (
                                <p style={{fontSize: '32px', color: '#4b5563'}}>ã‚«ãƒ³ãƒšå¾…æ©Ÿä¸­...</p>
                            )}
                        </div>
                    </div>
                );
            }

            // ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ - æ¥ç¶šå‰
            if (mode === 'director' && !isConnected) {
                return (
                    <div style={styles.container}>
                        <button onClick={() => setMode(null)} style={{position: 'absolute', top: '16px', left: '16px', background: 'none', border: 'none', color: '#9ca3af', fontSize: '20px', cursor: 'pointer'}}>
                            â† æˆ»ã‚‹
                        </button>
                        <div style={{textAlign: 'center', maxWidth: '448px'}}>
                            <h1 style={{fontSize: '40px', fontWeight: 'bold', marginBottom: '32px'}}>ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ç”»é¢</h1>
                            <div style={{marginBottom: '32px'}}>
                                <button onClick={createNewSession} style={{...styles.button, backgroundColor: '#16a34a', width: '100%'}}>
                                    æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
                                </button>
                            </div>
                            <div style={{borderTop: '2px solid #374151', paddingTop: '32px'}}>
                                <p style={{fontSize: '20px', marginBottom: '16px'}}>æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶š</p>
                                <input
                                    type="text"
                                    value={inputSessionId}
                                    onChange={(e) => setInputSessionId(e.target.value)}
                                    placeholder="ã‚»ãƒƒã‚·ãƒ§ãƒ³ID"
                                    style={{...styles.input, width: '100%'}}
                                    maxLength="6"
                                />
                                <button onClick={connectToSession} style={{...styles.button, backgroundColor: '#2563eb', width: '100%', padding: '12px 32px'}}>
                                    æ¥ç¶š
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ - ãƒ¡ã‚¤ãƒ³ç”»é¢
            return (
                <div style={{minHeight: '100vh', backgroundColor: '#000', color: '#fff', padding: '32px', paddingBottom: '32px'}}>
                    <div style={{maxWidth: '1024px', margin: '0 auto'}}>
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '32px', paddingBottom: '16px', borderBottom: '2px solid #374151'}}>
                            <div>
                                <h1 style={{fontSize: '32px', fontWeight: 'bold'}}>ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ç”»é¢</h1>
                                <p style={{fontSize: '20px', color: '#9ca3af', marginTop: '8px'}}>ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {sessionId}</p>
                                <p style={{fontSize: '14px', color: '#6b7280', marginTop: '4px'}}>æœ€çµ‚æ›´æ–°: {lastUpdate}</p>
                            </div>
                            <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                                <div style={{width: '16px', height: '16px', backgroundColor: connectionStatus === 'connected' ? '#22c55e' : '#ef4444', borderRadius: '50%'}} className={connectionStatus === 'connected' ? 'pulse' : ''}></div>
                                <span style={{fontSize: '20px'}}>{connectionStatus === 'connected' ? 'æ¥ç¶šä¸­' : 'åˆ‡æ–­'}</span>
                            </div>
                        </div>

                        <div style={{backgroundColor: '#111827', borderRadius: '12px', padding: '24px', marginBottom: '24px', border: '2px solid #374151'}}>
                            <h2 style={{fontSize: '24px', fontWeight: 'bold', marginBottom: '16px'}}>ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ</h2>
                            <div style={{fontSize: '64px', fontWeight: 'bold', marginBottom: '24px', textAlign: 'center'}}>
                                {formatStopwatch(stopwatchTime)}
                            </div>
                            <div style={{display: 'flex', gap: '16px'}}>
                                <button onClick={handleStart} disabled={isRunning} style={{flex: 1, fontSize: '20px', padding: '16px 24px', borderRadius: '8px', fontWeight: 'bold', border: 'none', cursor: isRunning ? 'not-allowed' : 'pointer', backgroundColor: isRunning ? '#374151' : '#16a34a', color: '#fff'}}>
                                    â–¶ï¸ é–‹å§‹
                                </button>
                                <button onClick={handlePause} disabled={!isRunning} style={{flex: 1, fontSize: '20px', padding: '16px 24px', borderRadius: '8px', fontWeight: 'bold', border: 'none', cursor: !isRunning ? 'not-allowed' : 'pointer', backgroundColor: !isRunning ? '#374151' : '#eab308', color: '#fff'}}>
                                    â¸ï¸ åœæ­¢
                                </button>
                                <button onClick={handleReset} style={{flex: 1, backgroundColor: '#dc2626', fontSize: '20px', padding: '16px 24px', borderRadius: '8px', fontWeight: 'bold', border: 'none', cursor: 'pointer', color: '#fff'}}>
                                    ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
                                </button>
                            </div>
                        </div>

                        <div style={{backgroundColor: '#111827', borderRadius: '12px', padding: '24px', border: '2px solid #374151'}}>
                            <h2 style={{fontSize: '24px', fontWeight: 'bold', marginBottom: '16px'}}>ã‚«ãƒ³ãƒšãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡</h2>
                            
                            {promptMessage && (
                                <div style={{backgroundColor: '#1e3a8a', border: '2px solid #2563eb', borderRadius: '8px', padding: '16px', marginBottom: '16px'}}>
                                    <p style={{fontSize: '14px', color: '#d1d5db', marginBottom: '4px'}}>ç¾åœ¨è¡¨ç¤ºä¸­:</p>
                                    <p style={{fontSize: '20px', fontWeight: 'bold'}}>{promptMessage}</p>
                                </div>
                            )}

                            <div style={{display: 'flex', gap: '12px', marginBottom: '16px'}}>
                                <input
                                    type="text"
                                    value={messageInput}
                                    onChange={(e) => setMessageInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSendCustomMessage()}
                                    placeholder="ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                                    style={{flex: 1, backgroundColor: '#1f2937', color: '#fff', fontSize: '18px', padding: '12px 16px', borderRadius: '8px', border: '2px solid #4b5563', outline: 'none'}}
                                />
                                <button onClick={handleSendCustomMessage} style={{backgroundColor: '#2563eb', fontSize: '18px', padding: '12px 32px', borderRadius: '8px', fontWeight: 'bold', border: 'none', cursor: 'pointer', color: '#fff'}}>
                                    ğŸ“¤ é€ä¿¡
                                </button>
                                <button onClick={handleClearMessage} style={{backgroundColor: '#374151', fontSize: '18px', padding: '12px 32px', borderRadius: '8px', fontWeight: 'bold', border: 'none', cursor: 'pointer', color: '#fff'}}>
                                    ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                                </button>
                            </div>

                            <div>
                                <p style={{fontSize: '14px', color: '#9ca3af', marginBottom: '12px'}}>ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</p>
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px'}}>
                                    {presetMessages.map((msg, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => sendMessage(msg)}
                                            style={{backgroundColor: '#1f2937', textAlign: 'left', padding: '12px 16px', borderRadius: '8px', border: '2px solid #4b5563', cursor: 'pointer', color: '#fff', fontSize: '16px'}}
                                        >
                                            {msg}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PodcastApp />, document.getElementById('root'));
    </script>
</body>
</html>
